<div class="breadcrumb">
    <h1>Cobranzas</h1>
    <ul>
        <li><a>Portal de pagos</a></li>
        <li>Cobranzas</li>
    </ul>
</div>

<div class="separator-breadcrumb border-top"></div>

<div class="card user-profile o-hidden mb-4" *ngIf="!muestraDetalle">
    <div class="header-cover" style="background-image: url('assets/images/Banner-Cobranzas.png')"></div>
    <div class="user-info">
        <img class="profile-picture avatar-lg mb-2" src="{{img}}" alt="">
    </div>
    <div class="col-md-12">
        <div class="row">

            <div class="col-md-12 form-group mb-3 mt-3">
                <div class="card mb-4 ">
                    <div class="card-header">
                        Cobranzas
                    </div>
                    <!--FCA 13-12-2021-->
                    <!-- <div class="form-group col-md-4 mb-3" style="margin-top: 20px;">
                        <label for="picker1" class="text-lbl">Tipo</label>
                        <ng-select class="customAC" style="border-radius: 40px !important;" [items]="modalidadCobranza"
                            appendTo="body" bindLabel="modalidad" required placeholder="Seleccione tipo cobranza"
                            #tipoFiltro="ngModel" name="tipoFiltro" [(ngModel)]="selectedModalidadCobranza"
                            bindValue="id" (change)="changeModalidadCobranza()">
                        </ng-select>
                    </div> -->
                    <div class="card-body">
                        <p class="card-text">Las cobranzas manuales permiten enviar los documentos pendientes a un
                            segmento de clientes seleccionado.</p>
                        <button id="sss3" (click)="crearCobranza()"
                            class="btn btn-success justify-content-between align-items-center mr-3"> <i
                                class="i-Cash-register-2 mr-3"></i> <span class="mr-3">Programar cobranza</span>
                        </button>
                        <button id="sss2" *ngIf="!muestraCabecera" (click)="mostrarFiltro()"
                            class="btn btn-info justify-content-between align-items-center mr-3"> <i
                                class="i-Filter-2 mr-3"></i> <span class="mr-3">{{textoBotonFiltro}}</span>
                        </button>
                        <button id="sss" *ngIf="muestraCabecera" (click)="cancelar()"
                            class="btn btn-outline-danger justify-content-between align-items-center mr-3"> <i
                                class="i-Close mr-3"></i> <span class="mr-3">Cancelar</span></button>
                        <!-- <button id="sss1" (click)="enviarCobranza()"
                            class="btn btn-success justify-content-between align-items-center mr-3" [loading]="loading">
                            <i class="i-Cash-register-2 mr-3"></i> <span class="mr-3">Enviar Cobranza</span>
                        </button>
                    </div> -->
                </div>
            </div>


            <div class="form-group col-md-4 mb-3" *ngIf="muestraFiltroCobranza">
                <label for="picker1" class="text-lbl">Tipo</label>
                <ng-select class="customAC" style="border-radius: 40px !important;" [items]="tiposCobranza"
                    appendTo="body" bindLabel="nombre" required placeholder="Seleccione tipo cobranza"
                    #tipoFiltro="ngModel" name="tipoFiltro" [(ngModel)]="selectedTipoFiltro" bindValue="idTipoCobranza">
                </ng-select>
            </div>

            <div class="form-group col-md-4 mb-3" *ngIf="muestraFiltroCobranza">
                <label for="nombre" class="text-lbl">Nombre</label>
                <div class="input-group">
                    <input type="text" maxlength="60" class="form-control" id="nombreFiltro" name="nombreFiltro"
                        [(ngModel)]="nombreFiltro" placeholder="Ingrese nombre cobranza">
                </div>
            </div>

            <!--FCA 13-12-2021-->
            <div class="form-group col-md-4 mb-3" *ngIf="muestraFiltroCobranza && selectedModalidadCobranza == 1">
                <label for="picker1" class="text-lbl">Estado Cobranza</label>
                <ng-select class="customAC" style="border-radius: 40px !important;" [items]="estadosCobranza"
                    appendTo="body" bindLabel="nombre" required placeholder="Seleccione estado cobranza"
                    #estadoFiltro="ngModel" name="estadoFiltro" [(ngModel)]="selectedEstadoFiltro"
                    bindValue="idEstadoCobranza">
                </ng-select>
            </div>

            <div class="col-md-2 form-group mb-3" *ngIf="muestraFiltroCobranza">
                <label for="lastName">Fecha Creación Desde</label>
                <div class="input-group">
                    <input class="form-control" placeholder="dd/mm/yyyy" readonly [container]="'body'" name="d2"
                        #c2="ngModel" [(ngModel)]="dateDesdeFiltro" ngbDatepicker #d2="ngbDatepicker"
                        [navigation]="'select'" [minDate]="{year: 1900, month: 1, day: 1}">
                    <div class="input-group-append">
                        <button class="btn btn-secondary" (click)="d2.toggle()" type="button">
                            <i class="icon-regular i-Calendar-4"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-2 form-group mb-3" *ngIf="muestraFiltroCobranza">
                <label for="lastName">Fecha Creación Hasta</label>
                <div class="input-group">
                    <input class="form-control" placeholder="dd/mm/yyyy" readonly [container]="'body'" name="d3"
                        #c3="ngModel" [(ngModel)]="dateHastaFiltro" ngbDatepicker #d3="ngbDatepicker"
                        [navigation]="'select'" [minDate]="{year: 1900, month: 1, day: 1}">
                    <div class="input-group-append">
                        <button class="btn btn-secondary" (click)="d3.toggle()" type="button">
                            <i class="icon-regular i-Calendar-4"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="form-group col-md-3 mb-3" *ngIf="muestraFiltroCobranza">
                <div class="pt-3 mt-2">
                    <button type="button" (click)="searchCobranzaClasica()" class="btn btn-primary btn-sm m-1"> <i
                            class="i-Filter-2 mr-2"></i> Filtrar</button>
                    <button type="button" (click)="cleanFiltersCobranzas()" class="btn btn-secondary btn-sm m-1"> <i
                            class="i-To-Left mr-2"></i> Limpiar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="col-md-12 form-group mb-3 mt-3" *ngIf="!muestraCabecera && !muestraDetalle">
    <div class="row mb-4" *ngIf="totalItems > 0">
        <!-- GRID AND LIST BUTTONS -->
        <div class="col-6">
            <!-- <button class="btn btn-sm btn-rounded btn-outline-light btn-svg mr-2"
                [ngClass]="{active: viewMode === 'grid'}" (click)="viewMode = 'grid'">
                <svg version="1.1" width="16px" id="grid" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 369.946 369.946"
                    style="enable-background:new 0 0 369.946 369.946;" xml:space="preserve">
                    <path d="M250.609,0h-11.934H131.271h-11.934H0v119.337v11.934v107.404v11.934v119.337h119.337h11.934
                  h107.404h11.934h119.337V250.609v-11.934V131.271v-11.934V0H250.609z M238.675,11.934v107.404H131.271V11.934H238.675z
                    M238.675,131.271v107.404H131.271V131.271H238.675z M11.934,11.934h107.404v107.404H11.934V11.934z M11.934,131.271h107.404
                  v107.404H11.934V131.271z M11.934,358.012V250.609h107.404v107.404H11.934z M131.271,358.012V250.609h107.404v107.404H131.271z
                    M358.012,358.012H250.609V250.609h107.404V358.012z M358.012,238.675H250.609V131.271h107.404V238.675z M250.609,119.337V11.934
                  h107.404v107.404H250.609z" />
                </svg>
            </button>
            <button class="btn btn-sm btn-rounded btn-outline-light btn-svg" [ngClass]="{active: viewMode === 'list'}"
                (click)="viewMode = 'list'">
                <svg version="1.1" id="list" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="16px" height="16px"
                    viewBox="0 0 612 612" style="enable-background:new 0 0 612 612;" xml:space="preserve">
                    <path
                        d="M0,97.92v24.48h612V97.92H0z M0,318.24h612v-24.48H0V318.24z M0,514.08h612V489.6H0V514.08z" />
                </svg>
            </button> -->
        </div>
    </div>

    <div *ngIf="totalItems > 0" class="row"
        [ngClass]="{'list-horizontal': viewMode === 'list', 'list-grid': viewMode === 'grid'}">
        <!-- SINGLE LIST ITEM -->
        <div *ngFor="let item of listaCobranzas | paginate: config; let i = index" class="list-item"
            [ngClass]="{'col-md-12': viewMode === 'list', 'col-md-3': viewMode === 'grid'}"
            [@animate]="{value:'*',params:{delay: (i*100)+'ms', y:'50px'}}">
            <div class="card o-hidden mb-2 d-flex"
                [ngClass]="{'flex-row': viewMode === 'list', 'flex-column': viewMode === 'grid'}">
                <div class="list-thumb d-flex ml-2">
                    <!-- TUMBNAIL -->
                    <img style="cursor: pointer;" (click)="verDetalle(item)" src="{{img}}" width="60" height="60"
                        alt="">
                </div>
                <div class="flex-grow-1"
                    [ngClass]="{'pl-2 d-flex': viewMode === 'list', 'd-bock': viewMode === 'grid'}">
                    <div class="card-body align-self-center d-flex flex-column justify-content-between align-items-lg-center"
                        [ngClass]="{'flex-lg-row': viewMode === 'list'}">
                        <!-- OTHER DATA -->
                        <p class="m-0 text-muted w-15 w-sm-100" style="flex-basis:200px">
                            {{item.nombre}}
                        </p>
                        <!--FCA 13-12-2021-->
                        <p *ngIf="selectedModalidadCobranza == 1" class="m-0 text-muted w-15 w-sm-100"
                            style="flex-basis:200px">
                            <strong>Estado: </strong> {{item.nombreEstado}}
                        </p>
                        <p class="m-0 text-muted w-15 w-sm-100">
                            <!--FCA 13-12-2021-->
                            <strong *ngIf="selectedModalidadCobranza == 1">Fecha envío: </strong>
                            <strong *ngIf="selectedModalidadCobranza == 2">Fecha desde: </strong> {{item.fechaInicio |
                            date: 'dd/MM/yyyy'}}
                        </p>



                        <!--FCA 13-12-2021-->
                        <p *ngIf="selectedModalidadCobranza == 2" class="m-0 text-muted w-15 w-sm-100"
                            style="flex-basis:100px">
                            <strong>Fecha Hasta: </strong> {{item.fechaFin | date: 'dd/MM/yyyy'}}
                        </p>

                        <p class="m-0 text-muted w-15 w-sm-100" *ngIf="item.enviaEnlacePago == 0"
                            style="flex-basis:100px">
                            <strong>Tipo: </strong> {{item.nombreTipoCobranza}}
                        </p>
                        <!-- <p class="m-0 text-muted w-15 w-sm-100" *ngIf="item.enviaEnlacePago == 1">
                    <strong>A recaudar: </strong> ${{item.totalRecaudar | monto}}
                </p> -->
                        <!--FCA 13-12-2021-->
                        <!-- <p class="m-0 text-muted w-15 w-sm-100"
                            *ngIf="item.enviaEnlacePago == 1 && selectedModalidadCobranza == 1">
                            <strong>Recaudado: </strong> ${{item.totalRecaudado | monto}}
                        </p> -->
                        <!--FCA 13-12-2021-->
                        <!-- <p class="m-0 text-muted text-18 w-15 w-sm-100 d-none d-lg-block item-badges"
                            *ngIf="item.enviaEnlacePago == 1 && selectedModalidadCobranza == 1">
                            <span ngbTooltip="Estado recaudación"
                                class="badge badge-{{item.colorPorcentajeRecaudacion}}">{{item.porcentajeRecaudacion}}%</span>
                        </p> -->
                        <!--FCA 13-12-2021-->
                        <div ngbDropdown container="body">
                            <button ngbDropdownToggle aria-haspopup="true" aria-expanded="false" type="button"
                                class="btn dropdown-toggle btn-link text-decoration-none dropdown-toggle-no-caret"
                                id="__BVID__735__BV_toggle_"><svg xmlns="http://www.w3.org/2000/svg" width="16px"
                                    height="16px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round"
                                    class="text-body align-middle mr-25 feather feather-more-vertical">
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <circle cx="12" cy="5" r="1"></circle>
                                    <circle cx="12" cy="19" r="1"></circle>
                                </svg></button>
                            <div ngbDropdownMenu>
                                <button *ngIf="selectedModalidadCobranza == 1" (click)="verDetalleCobranza(item)"
                                    style="cursor: pointer; " ngbDropdownItem><i class="i-Edit"
                                        style="font-size: 1.4em;"></i>&nbsp;&nbsp;&nbsp;Ver detalle</button>
                                <button *ngIf="item.idEstado == 1" (click)="deleteCobranza(item)"
                                    style="cursor: pointer;" ngbDropdownItem><i class="i-Remove"
                                        style="font-size: 1.4em;"></i>&nbsp;&nbsp;&nbsp;Eliminar</button>

                                <!-- <img *ngIf="selectedModalidadCobranza == 2" (click)="desactivar(item)" container="body"
                                    ngbTooltip="Desactivar/Activar" style="cursor: pointer;"
                                    src="https://img.icons8.com/cute-clipart/2x/forgot-password.png" width="25"
                                    height="25" alt="">
                                <img *ngIf="selectedModalidadCobranza == 2" (click)="delete(item)" container="body"
                                    ngbTooltip="Eliminar" style="cursor: pointer;"
                                    src="https://img.icons8.com/cute-clipart/2x/delete-forever.png" width="25"
                                    height="25" alt="">
                                <img *ngIf="item.idEstadoCobranza == 1" (click)="deleteCobranza(item)" container="body"
                                    ngbTooltip="Eliminar" style="cursor: pointer;"
                                    src="https://img.icons8.com/cute-clipart/2x/delete-forever.png" width="25"
                                    height="25" alt=""> -->
                            </div>
                        </div>

                        <!-- <p class="m-0 text-muted w-15 w-sm-100" style="flex-basis:100px">
                            <img *ngIf="selectedModalidadCobranza == 1" (click)="verDetalleCobranza(item)"
                                container="body" ngbTooltip="Ver detalle" style="cursor: pointer;"
                                src="assets/images/show-property.png" width="25" height="25" alt="">
                            <img *ngIf="selectedModalidadCobranza == 2" (click)="desactivar(item)" container="body"
                                ngbTooltip="Desactivar/Activar" style="cursor: pointer;"
                                src="https://img.icons8.com/cute-clipart/2x/forgot-password.png" width="25" height="25"
                                alt="">
                            <img *ngIf="selectedModalidadCobranza == 2" (click)="delete(item)" container="body"
                                ngbTooltip="Eliminar" style="cursor: pointer;"
                                src="https://img.icons8.com/cute-clipart/2x/delete-forever.png" width="25" height="25"
                                alt="">
                        </p> -->
                    </div>
                </div>
            </div>
        </div>
        <!-- PAGINATION CONTROL -->
        <div class="col-md-12 mt-3" *ngIf="listaCobranzas?.length && totalItems > 0">
            <pagination-controls (pageChange)="changePage($event)" maxSize="6" responsive="true" previousLabel=""
                nextLabel="">
            </pagination-controls>
            <!-- <pagination-controls (pageChange)="page = $event" previousLabel="" nextLabel=""></pagination-controls> -->
        </div>
    </div>

    <div class="row" *ngIf="totalItems == 0">
        <div class="col-md-12">
            <ngb-alert class="alert-card text-center" [dismissible]="false">
                {{noResultsText}}
            </ngb-alert>
        </div>
    </div>
</div>
<div class="row" *ngIf="nuevaCobranza">
    <div class="col-md-12 mt-3 mb-3">

        <form-wizard id="wizard1" (onStepChanged)="onStepChangedl(wz, step1, step2, step3, step4, step5)">
            <wizard-step #step1 [title]="'Programación'" [isValid]="IsStepOneOk" (onNext)="onStep1Next($event)">
                <!-- <form #basicForm="ngForm"> -->
                <div class="row" style="overflow-y: hidden;">
                    <div class="col-md-12 mb-3 mt-4">
                        <span style="font-size: 16px; font-weight: 600;">1. Seleccione tipo de envío</span>
                    </div>

                    <div class="col-md-12 mb-2">
                        <ul class="ulSel">
                            <li class="liSel" *ngFor="let t of tiposCobranza; let i = index"
                                ngbTooltip="{{t.nombre}}: {{t.descripcion}}">
                                <input type="checkbox" id="cb{{t.idTipoCobranza}}"
                                    (change)="changeTipoCobranza(t, $event)" />
                                <label class="labelSel" style="border: 1px solid #e0e0eb;"
                                    for="cb{{t.idTipoCobranza}}"><img style="width:80px;height: 80px;"
                                        [src]="i == 1 ? img : img2" /></label>
                            </li>
                        </ul>

                        <label class="checkbox checkbox-primary">
                            <input type="checkbox" [checked]="chkClientesExcluidos" name="inputName"
                                [(ngModel)]="chkClientesExcluidos">
                            <span>Activar el listado de clientes excluidos</span>
                            <span class="checkmark"></span>
                        </label>
                    </div>

                    <div class="col-md-12 mb-3 separator-breadcrumb border-top"></div>

                    <div class="col-md-12 mb-3 mt-4">
                        <span style="font-size: 16px; font-weight: 600;">2. ¿Cual es su tipo de programación?</span>
                    </div>
                    <div class="col-md-12 mb-2">
                        <!-- <label class="radio radio-primary mt-4">
                            <input type="radio" name="radio" [value]="1" [(ngModel)]="selectedProgramacion">
                            <span class="ml-4">Programación Clasica</span>
                            <span class="checkmark"></span>
                        </label> -->

                        <div class="col-md-12 mt-2" *ngIf="selectedProgramacion == 1">
                            <div class="form-group row mt-2">
                                <label class="col-sm-4 col-form-label">Se programará el envío para el</label>
                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <input class="form-control" placeholder="dd/mm/yyyy" readonly name="d1"
                                            [container]="'body'" (ngModelChange)="cambiaFecha($event,1)" #c1="ngModel"
                                            [(ngModel)]="fecha" ngbDatepicker #d1="ngbDatepicker"
                                            [navigation]="'select'" [minDate]="{year: 2000, month: 1, day: 1}">
                                        <div class="input-group-append">
                                            <button class="btn btn-secondary" (click)="d1.toggle();" type="button">
                                                <i class="icon-regular i-Calendar-4"></i>
                                            </button>
                                            <button class="btn btn-secondary" (click)="fecha = null" type="button">
                                                <i class="icon-regular i-Paint-Brush"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <ngb-alert
                                        *ngIf="mensajeFechaInicioErronea != '' && mensajeFechaInicioErronea != null"
                                        class="alert-card text-center" [dismissible]="false">
                                        {{mensajeFechaInicioErronea}}
                                    </ngb-alert>
                                </div>

                            </div>

                            <div class="form-group row">
                                <label class="col-sm-4 col-form-label">A las</label>
                                <div class="col-sm-4">
                                    <ng-select class="customAC"
                                        style="border-radius: 40px !important; max-height: 120px;"
                                        (open)="handleFocus()" [items]="horarios" bindLabel="horario"
                                        placeholder="Horas" #cc="ngModel" name="cc" [(ngModel)]="selectedHorario"
                                        bindValue="hora">
                                    </ng-select>
                                </div>
                            </div>

                            <div class="form-group row mb-4" style="height: 200px;">
                                <label class="col-sm-4 col-form-label">El enlace de pago se deshabilitará el </label>
                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <input class="form-control" placeholder="dd/mm/yyyy" readonly name="v1"
                                            [container]="'body'" (ngModelChange)="cambiaFecha($event,2)" #g1="ngModel"
                                            [(ngModel)]="fechaVencimiento" ngbDatepicker #v1="ngbDatepicker"
                                            [navigation]="'select'" [minDate]="{year: 2000, month: 1, day: 1}">
                                        <div class="input-group-append">
                                            <button class="btn btn-secondary" (click)="v1.toggle()" type="button">
                                                <i class="icon-regular i-Calendar-4"></i>
                                            </button>
                                            <button class="btn btn-secondary" (click)="fechaVencimiento = null"
                                                type="button">
                                                <i class="icon-regular i-Paint-Brush"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <ngb-alert
                                        *ngIf="mensajeFechaTerminoErronea != '' && mensajeFechaTerminoErronea != null"
                                        class="alert-card text-center" [dismissible]="false">
                                        {{mensajeFechaTerminoErronea}}
                                    </ngb-alert>
                                </div>

                            </div>
                        </div>

                        <!-- <label class="radio radio-secondary">
                            <input type="radio" name="radio2" [value]="2" [(ngModel)]="selectedProgramacion">
                            <span class="ml-4">Programación Inteligente</span>
                            <span class="checkmark"></span>
                        </label> -->

                        <div class="col-md-12" *ngIf="selectedProgramacion == 2" style="margin-bottom: 200px;">

                            <div class="form-group row mt-5">
                                <div class="col-sm-3">
                                    <label class="checkbox checkbox-primary">
                                        <input type="checkbox" [checked]="chkFeriados" name="inputFeriados"
                                            [(ngModel)]="chkFeriados" (change)="seleccionaPeriocidad()">
                                        <span>Excluir Feriados</span>
                                        <span class="checkmark"></span>
                                    </label>
                                </div>
                                <div class="col-sm-4">
                                    <label class="checkbox checkbox-primary">
                                        <input type="checkbox" [checked]="chkFines" name="inputFines"
                                            [(ngModel)]="chkFines" (change)="seleccionaPeriocidad()">
                                        <span>Excluir fines de semana</span>
                                        <span class="checkmark"></span>
                                    </label>
                                </div>


                            </div>

                            <div class="form-group row">
                                <label class="col-sm-4 col-form-label">Frecuencia de envío</label>
                                <div class="col-sm-4">
                                    <ng-select class="customAC" style="border-radius: 40px !important;"
                                        [items]="frecuencias" bindLabel="frecuencia" placeholder="Frecuencia de envío"
                                        #ff="ngModel" name="ff" [(ngModel)]="selectedFrecuencia" bindValue="id">
                                    </ng-select>
                                </div>
                            </div>
                            <div class="form-group row" *ngIf="selectedFrecuencia == 1">
                                <label class="col-sm-4 col-form-label">Los días</label>
                                <div class="col-sm-4">
                                    <ng-select class="customAC" style="border-radius: 40px !important;"
                                        [items]="frecuenciaDias" bindLabel="dia" placeholder="Seleccione Días"
                                        multiple="true" #dd="ngModel" name="dd" [(ngModel)]="selectedDia"
                                        bindValue="id">
                                    </ng-select>
                                </div>
                            </div>
                            <div class="form-group row" *ngIf="selectedFrecuencia == 2">
                                <label class="col-sm-4 col-form-label">Se programara el envío para</label>
                                <div class="col-sm-4">
                                    <ng-select class="customAC" style="border-radius: 40px !important;"
                                        (click)="seleccionaPeriocidad()" [items]="periocidades" bindLabel="nombre"
                                        placeholder="Seleccione periocidad" #pp="ngModel" name="pp"
                                        [(ngModel)]="selectedPeriocidad" bindValue="idPeriocidad">
                                    </ng-select>
                                </div>
                                <img *ngIf="selectedPeriocidad != null && mensajeInfo != ''" container="body"
                                    ngbTooltip="{{mensajeInfo}}" style="cursor: pointer; margin-top: 7px;"
                                    src="assets/images/icon/info.png" alt="" width="22" height="22">
                            </div>

                            <div class="form-group row" *ngIf="selectedFrecuencia == 2 && selectedPeriocidad == 4">
                                <label class="col-sm-4 col-form-label">Día de envío</label>
                                <div class="col-sm-4">
                                    <input type="number" min="0" class="form-control mr-2" id="caja" name="diaEnvio"
                                        placeholder="Ingrese dia de envío" [(ngModel)]="diaEnvio">
                                </div>

                            </div>
                            <div class="form-group row" *ngIf="selectedFrecuencia == 1 || selectedFrecuencia == 2">
                                <label class="col-sm-4 col-form-label">A las</label>
                                <div class="col-sm-4">
                                    <ng-select class="customAC" style="border-radius: 40px !important;"
                                        (open)="handleFocus()" [items]="horarios" bindLabel="horario"
                                        placeholder="Horas" #cc="ngModel" name="cc" [(ngModel)]="selectedHorario"
                                        bindValue="idHorario">
                                    </ng-select>
                                </div>
                            </div>

                            <div class="form-group row mt-2" *ngIf="selectedFrecuencia == 1 || selectedFrecuencia == 2">
                                <label class="col-sm-4 col-form-label">La cobranza iniciara el</label>
                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <input class="form-control" placeholder="dd/mm/yyyy" readonly name="d2"
                                            [container]="'body'" (ngModelChange)="cambiaFecha($event,1)" #c2="ngModel"
                                            [(ngModel)]="fecha" ngbDatepicker #d2="ngbDatepicker"
                                            [navigation]="'select'" [minDate]="{year: 1900, month: 1, day: 1}">
                                        <div class="input-group-append">
                                            <button class="btn btn-secondary" (click)="d2.toggle()" type="button">
                                                <i class="icon-regular i-Calendar-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="form-group row mb-4" *ngIf="selectedFrecuencia == 1 || selectedFrecuencia == 2">
                                <label class="col-sm-4 col-form-label">La cobranza dejara de estar activa el</label>
                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <input class="form-control" placeholder="dd/mm/yyyy" name="v2"
                                            [container]="'body'" (ngModelChange)="cambiaFecha($event,2)" #g2="ngModel"
                                            [(ngModel)]="fechaVencimiento" ngbDatepicker #v2="ngbDatepicker"
                                            [navigation]="'select'" [minDate]="{year: 1900, month: 1, day: 1}">
                                        <div class="input-group-append">
                                            <button class="btn btn-secondary" (click)="v2.toggle()" type="button">
                                                <i class="icon-regular i-Calendar-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <!-- </form> -->
            </wizard-step>






            <wizard-step #step2 id="step2" [title]="'Documentos'" [isValid]="IsStepTwoOk"
                (onNext)="onStep2Next($event)">

                <div class="row" style="padding-bottom: 200px;">
                    <div class="col-md-12 mb-4 mt-4">
                        <span style="font-size: 16px; font-weight: 600;">1. Ingrese las condiciones para identificar los
                            documentos que se enviarán en cobranza o pre cobranza</span>
                    </div>
                    <!-- 
                    <div class="form-group col-md-4 mb-3">
                        <label for="picker1" class="text-lbl">Año (*)</label>
                         <ng-select class="customAC" style="border-radius: 40px !important;" [items]="anios"
                            appendTo="body" bindLabel="anioMatricula" required placeholder="Año" #aniosm="ngModel"
                            name="aniosm" (change)="onChangeSelect(1)" [(ngModel)]="selectedAnio" bindValue="id">
                        </ng-select> 
                        <ng-select class="customAC" style="border-radius: 40px !important;" [items]="anios"
                            appendTo="body" bindLabel="anioMatricula" required placeholder="Año" #aniosm="ngModel"
                            name="aniosm" [(ngModel)]="selectedAnio" bindValue="id">
                        </ng-select>
                    </div> -->

                    <div class="form-group col-md-4 mb-3">
                        <label for="picker1" class="text-lbl">Tipo Documento (*)</label>
                        <!-- <ng-select class="customAC" style="border-radius: 40px !important;" [items]="tiposDocumento"
                            bindLabel="desDoc" placeholder="Tipos de documento" #lpo="ngModel" name="lpo"
                            [(ngModel)]="selectedTipoDoc" bindValue="codDoc" [multiple]="true"
                            [closeOnSelect]="false" (change)="onChangeSelect(2)">
                        </ng-select> -->
                        <ng-select class="customAC" style="border-radius: 40px !important;" [items]="tiposDocumento"
                            bindLabel="desDoc" placeholder="Tipos de documentos" #lpo="ngModel" name="lpo"
                            [(ngModel)]="selectedTipoDoc" bindValue="codDoc" [multiple]="true" [closeOnSelect]="false">
                        </ng-select>
                    </div>

                    <!-- <div class="form-group col-md-4 mb-3">
                        <label for="picker1" class="text-lbl">Lista de precios</label>
                        <ng-select class="customAC" style="border-radius: 40px !important;" [items]="listasPrecio"
                            bindLabel="desLista" placeholder="Lista de precio" #listasPrecios="ngModel"
                            name="listasPrecios" [(ngModel)]="selectedListaPrecio" bindValue="codLista"
                            [multiple]="true" [closeOnSelect]="true">
                        </ng-select>
                    </div> -->
                    <div class="form-group col-md-4 mb-3">
                        <label for="picker1" class="text-lbl">Categoría cliente</label>
                        <ng-select class="customAC" style="border-radius: 40px !important;" [items]="categoriasCliente"
                            bindLabel="catDes" placeholder="Categoría Cliente" #categoriasClientes="ngModel"
                            name="categoriasClientes" [(ngModel)]="selectedCatCliente" bindValue="catCod"
                            [multiple]="true" [closeOnSelect]="false">
                        </ng-select>
                    </div>
                    <div class="form-group col-md-4 mb-3">
                        <label for="picker1" class="text-lbl">Vendedor</label>
                        <ng-select class="customAC" style="border-radius: 40px !important;" [items]="vendedores"
                            bindLabel="venDes" placeholder="Vendedores" #vendedoress="ngModel" name="vendedoress"
                            [(ngModel)]="selectedVendedor" bindValue="venCod" [multiple]="true" [closeOnSelect]="false">
                        </ng-select>
                    </div>

                    <div class="form-group col-md-4 mb-3">
                        <label for="picker1" class="text-lbl">Condición de venta</label>
                        <ng-select class="customAC" style="border-radius: 40px !important;" [items]="condicionesVenta"
                            bindLabel="cveDes" placeholder="Condición de venta" #condicionesVentas="ngModel"
                            name="condicionesVentas" [(ngModel)]="selectedCondicionVenta" bindValue="cveCod"
                            [multiple]="true" [closeOnSelect]="false">
                        </ng-select>
                    </div>

                    <!-- <div class="form-group col-md-4 mb-3">
                        <label for="picker1" class="text-lbl">Canales de Venta</label>
                        <ng-select class="customAC" style="border-radius: 40px !important;" [items]="canalesVenta"
                            bindLabel="canDes" placeholder="Canal de Venta" #canalVenta="ngModel"
                            name="canalVenta" [(ngModel)]="selectedCanalesVenta" bindValue="canCod"
                            [multiple]="true" [closeOnSelect]="false">
                        </ng-select>
                    </div>

                    <div class="form-group col-md-4 mb-3">
                        <label for="picker1" class="text-lbl">Cobradores</label>
                        <ng-select class="customAC" style="border-radius: 40px !important;" [items]="cobradores"
                            bindLabel="cobDes" placeholder="Cobrador" #cobrador="ngModel"
                            name="cobrador" [(ngModel)]="selectedCobradores" bindValue="cobCod"
                            [multiple]="true" [closeOnSelect]="false">
                        </ng-select>
                    </div> -->

                    <!-- <div class="form-group col-md-4 mb-3" *ngIf="selectedTipoCobranza == 2">
                        <label for="picker1" class="text-lbl">{{textoCantidad}}</label>
                        <input type="number" min="0" class="form-control mr-2" id="caja" name="dias"
                            placeholder="Días antes del vencimiento" [(ngModel)]="diasVencimiento">
                    </div> -->



                    <div class="col-md-4 form-group mb-3">
                        <label *ngIf="selectedTipoCobranza == 1" for="lastName">Vencidos Desde</label>
                        <label *ngIf="selectedTipoCobranza == 2" for="lastName">Próximos a vencer desde</label>
                        <div class="input-group">
                            <input class="form-control" placeholder="dd/mm/yyyy" readonly [container]="'body'" name="d2"
                                #c2="ngModel" [(ngModel)]="dateDesde" ngbDatepicker #d2="ngbDatepicker"
                                [navigation]="'select'" [minDate]="{year: 1900, month: 1, day: 1}">
                            <div class="input-group-append">
                                <button class="btn btn-secondary" (click)="d2.toggle()" type="button">
                                    <i class="icon-regular i-Calendar-4"></i>
                                </button>
                                <button class="btn btn-secondary" (click)="dateDesde = null" type="button">
                                    <i class="icon-regular i-Paint-Brush"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 form-group mb-3" style="height: 20px;">
                        <label for="lastName">Hasta</label>
                        <div class="input-group">
                            <input class="form-control" placeholder="dd/mm/yyyy" readonly [container]="'body'" name="d3"
                                #c3="ngModel" [(ngModel)]="dateHasta" ngbDatepicker #d3="ngbDatepicker"
                                [navigation]="'select'" [minDate]="{year: 1900, month: 1, day: 1}">
                            <div class="input-group-append">
                                <button class="btn btn-secondary" (click)="d3.toggle()" type="button">
                                    <i class="icon-regular i-Calendar-4"></i>
                                </button>
                                <button class="btn btn-secondary" (click)="dateHasta = null" type="button">
                                    <i class="icon-regular i-Paint-Brush"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                </div>


                <!-- <div class="row text-center mt-3" style="justify-content: center;">
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                            <div class="card-body text-center">
                                <i class="i-Ticket"></i>
                                <div class="content" style="max-width: 100% !important;">
                                    <p><span class="lead text-primary text-20 mb-2"
                                            style="font-weight: 600;">{{cantidadDocumentosFiltro}}</span> <span
                                            class="text-primary mt-2 mb-0"> Documentos</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> -->

                <div class="row" *ngIf="muestraDetalleDocumentos">

                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-body">
                                <ngx-datatable style="height: 500px; box-shadow: none" class="material"
                                    [rows]="documentos" [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50"
                                    [rowHeight]="50" [limit]="10" [scrollbarV]="true" [scrollbarH]="true"
                                    [selectAllRowsOnPage]="false"
                                    [messages]="{emptyMessage:'No se encontraron resultados.', totalMessage: 'Registros', selectedMessage: 'Seleccionados'}">
                                    <ngx-datatable-column name="folioDocumento" [width]="80" [maxWidth]="100">
                                        <ng-template ngx-datatable-header-template>
                                            Folio
                                        </ng-template>
                                    </ngx-datatable-column>
                                    <ngx-datatable-column name="tipoDocumento" [width]="200">
                                        <ng-template ngx-datatable-header-template>
                                            Documento
                                        </ng-template>
                                    </ngx-datatable-column>
                                    <ngx-datatable-column name="rutCliente" [width]="200">
                                        <ng-template ngx-datatable-header-template>
                                            Cliente
                                        </ng-template>
                                    </ngx-datatable-column>
                                    <ngx-datatable-column name="fechaEmision" [width]="100">
                                        <ng-template ngx-datatable-header-template>
                                            Emisión
                                        </ng-template>
                                        <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                                            {{ value | date: 'dd/MM/yyyy'}}
                                        </ng-template>
                                    </ngx-datatable-column>
                                    <ngx-datatable-column name="fechaVencimiento" [width]="100">
                                        <ng-template ngx-datatable-header-template>
                                            Vencimiento
                                        </ng-template>
                                        <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                                            {{ value | date: 'dd/MM/yyyy'}}
                                        </ng-template>
                                    </ngx-datatable-column>
                                    <ngx-datatable-column name="montoDocumento" [width]="120">
                                        <ng-template ngx-datatable-header-template>
                                            Total
                                        </ng-template>
                                        <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                                            ${{ value | monto }}
                                        </ng-template>
                                    </ngx-datatable-column>
                                    <ngx-datatable-column name="SaldoDocumento" [width]="120">
                                        <ng-template ngx-datatable-header-template>
                                            Saldo
                                        </ng-template>
                                        <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                                            ${{ value | monto }}
                                        </ng-template>
                                    </ngx-datatable-column>
                                    <ngx-datatable-column name="diasAtraso">
                                        <ng-template ngx-datatable-header-template>
                                            Días Atraso
                                        </ng-template>
                                    </ngx-datatable-column>
                                </ngx-datatable>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="row ml-4" *ngIf="enviaLinkPago == 0 && selectedTipoCobranza == 1">
                    <label class="text-danger">*El tipo de documento seleccionado no genera pagos Webpay del cliente,
                        solo se enviará correo con detalle de la deuda.</label>
                </div>
            </wizard-step>

            <wizard-step #step3 [title]="'Envíos'" (onNext)="onStep3Next($event)" [isValid]="IsStepTreeOk">
                <div class="row" *ngIf="selectedProgramacion == 1">
                    <div class="col-md-12 mb-3 mt-3">
                        <span style="font-size: 16px; font-weight: 600;">Seleccione a los clientes que desea enviarles correo de cobranza o pre cobranza (dependiendo del tipo de envío indicado en el   paso 1)</span>
                    </div>
                    <div class="form-group col-md-3 mb-3">
                        <label for="rutCliente" class="text-lbl">Rut Cliente</label>
                        <input type="text" class="form-control" (blur)="validateRut()" id="rutCliente" name="rutCliente"
                            [(ngModel)]="searchRut" placeholder="Ingrese Rut Cliente">
                    </div>

                    <div class="form-group col-md-3 mb-3">
                        <label for="codAuxCliente" class="text-lbl">Código Auxiliar</label>
                        <input type="text" class="form-control"  id="codAuxCliente" name="codAuxCliente"
                            [(ngModel)]="searchCodAux" placeholder="Ingrese Código Auxiliar Cliente">
                    </div>

                    <div class="form-group col-md-3 mb-3">
                        <div class="pt-3 mt-2">
                            <button type="button" (click)="filter()" class="btn btn-primary btn-sm m-1"> <i
                                    class="i-Filter-2 mr-2"></i> Filtrar</button>
                            <button type="button" (click)="cleanFilters()" class="btn btn-secondary btn-sm m-1"> <i
                                    class="i-To-Left mr-2"></i> Limpiar</button>
                        </div>
                    </div>
                </div>
                <div class="row" *ngIf="detalleClientes.length >0 && selectedProgramacion == 1">
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-body">
                                <!--DESKTOP-->
                                <div class="desktop">
                                    <div class="material-datatables">
                                        <table class="table table-striped table-no-bordered table-hover">
                                            <thead>
                                                <tr>
                                                    <th scope="col">
                                                        <label *ngIf="detalleClientes.length > 1" class="checkbox checkbox-outline-primary"
                                                            style="margin-bottom: 20px;">
                                                            <input type="checkbox" name="checkAllSel"
                                                                [(ngModel)]="checkAll" (change)="onSelAll($event)">
                                                            <span class="checkmark"></span>
                                                        </label>
                                                    </th>
                                                    <th scope="col">Código Auxiliar</th>
                                                    <th scope="col">Rut</th>
                                                    <th scope="col">Cliente</th>
                                                    <th scope="col">Total Deuda</th>
                                                    <th scope="col">Doc. Pendientes</th>
                                                    <th scope="col">Detalle</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let c of detalleClientes | paginate: config">
                                                    <th scope="row">
                                                        <label class="checkbox checkbox-outline-primary">
                                                            <input [disabled]="c.cantidadDoctos == 0" type="checkbox" name="checkSel"
                                                                [(ngModel)]="c.selected" (change)="onSel($event, c)">
                                                            <span class="checkmark"></span>
                                                        </label>
                                                    </th>
                                                    <td>{{ c.codaux }}</td>
                                                    <td>{{ c.rutaux }}</td>
                                                    <td>{{ c.nomaux }}</td>
                                                    <td>{{ c.saldototal | monto }}</td>
                                                    <td>{{ c.cantidadDoctos}}</td>
                                                    <td style="text-align: center;">
                                                        <img *ngIf="c.estadoDatos != -1"
                                                            (click)="verDetalle(c,modalDetalle)" container="body"
                                                            ngbTooltip="Ver Detalle" style="cursor: pointer;"
                                                            src="assets/images/show-property.png" width="27" height="27"
                                                            alt="">
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!--MOVIL-->
                                <div class="movil">
                                    <div class="material-datatables">
                                        <table class="table table-striped table-no-bordered table-hover">
                                            <thead>
                                                <tr>
                                                    <th scope="col">
                                                        <label *ngIf="detalleClientes.length > 1" class="checkbox checkbox-outline-primary"
                                                            style="margin-bottom: 20px;">
                                                            <input type="checkbox" name="checkAllSel"
                                                                [(ngModel)]="checkAll" (change)="onSelAll($event)">
                                                            <span class="checkmark"></span>
                                                        </label>
                                                    </th>
                                                    <th scope="col">Cliente</th>
                                                    <th scope="col">Detalle</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let c of detalleClientes | paginate: config">
                                                    <td scope="row">
                                                        <label class="checkbox checkbox-outline-primary">
                                                            <input type="checkbox" name="checkSel"
                                                                [(ngModel)]="c.selected" (change)="onSel($event, c)">
                                                            <span class="checkmark"></span>
                                                        </label>
                                                    </td>

                                                    <td>
                                                        <strong>Rut: </strong>{{ c.rutaux }}<br />
                                                        <strong>Cliente: </strong>{{ c.nomaux }}<br />
                                                        <strong>Total Deuda: </strong>{{ c.saldototal | monto }}<br />
                                                        <strong>Doc. Pendientes: </strong>{{
                                                        c.cantidadDoctos}}<br />
                                                        <br />
                                                    </td>

                                                    <td style="text-align: center; vertical-align: middle;">
                                                        <img *ngIf="c.estadoDatos != -1"
                                                            (click)="verDetalle(c,modalDetalle)" container="body"
                                                            ngbTooltip="Ver Detalle" style="cursor: pointer;"
                                                            src="assets/images/show-property.png" width="27" height="27"
                                                            alt="">
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-md-12 mt-3" *ngIf="detalleClientePag?.length > 0">
                                    <pagination-controls (pageChange)="changePageClientes($event)" maxSize="6"
                                        responsive="true" previousLabel="" nextLabel="">
                                    </pagination-controls>
                                    <!-- <pagination-controls (pageChange)="page = $event" previousLabel="" nextLabel=""></pagination-controls> -->
                                </div>


                                <div class="row text-center mt-4" style="justify-content: center;">
                                    <div class="col-lg-4 col-md-4 col-sm-4">
                                        <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                                            <div class="card-body text-center">
                                                <i class="i-Mail-Add-"></i>
                                                <div class="content" style="max-width: 90px !important;">
                                                    <p class="text-primary mt-2 mb-0">Clientes Seleccionados</p>
                                                    <p class="lead text-primary text-19 mb-2" style="font-weight: 600;">
                                                        {{correosSeleccionados}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- <div class="col-lg-4 col-md-4 col-sm-4">
                                        <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                                            <div class="card-body text-center">
                                                <i class="i-Mail-Send"></i>
                                                <div class="content" style="max-width: 90px !important;">
                                                    <p class="text-primary mt-2 mb-0">A Recaudar</p>
                                                    <p class="lead text-primary text-19 mb-2" style="font-weight: 600;">
                                                        ${{ totalPagar |
                                                        monto}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row" *ngIf="selectedProgramacion == 2">
                    <div class="col-md-12 mb-4 mt-4">
                        <span style="font-size: 16px; font-weight: 600;">3. Ingrese las condiciones para identificar los
                            clientes a los que se le enviará la cobranza</span>
                    </div>

                    <div class="col-md-3 form-group mb-3">
                        <label for="lastName">Deuda desde</label>
                        <div class="input-group">
                            <!--FCA 13-12-2021-->
                            <input type="text" class="form-control" currencyMask [(ngModel)]="montoDesdeFiltro"
                                [options]="{ prefix: '$ ', thousands: '.', decimal: ',', precision: 0 }"
                                name="montoDesde" placeholder="Monto desde">
                        </div>
                    </div>
                    <div class="col-md-3 form-group mb-3">
                        <label for="lastName">Deuda hasta</label>
                        <div class="input-group">
                            <!--FCA 13-12-2021-->
                            <input type="text" class="form-control" currencyMask [(ngModel)]="montoHastaFiltro"
                                [options]="{ prefix: '$ ', thousands: '.', decimal: ',', precision: 0 }"
                                name="montoHasta" placeholder="Monto hasta">
                        </div>
                    </div>
                    <!--FCA 13-12-2021-->
                    <div class="form-group col-md-3 mb-3">
                        <div class="pt-3 mt-2">
                            <button type="button" (click)="filter2()" class="btn btn-primary btn-sm m-1"> <i
                                    class="i-Filter-2 mr-2"></i> Filtrar</button>
                            <button type="button" (click)="cleanFilters2()" class="btn btn-secondary btn-sm m-1"> <i
                                    class="i-To-Left mr-2"></i> Limpiar</button>
                        </div>
                    </div>
                </div>
                <!--FCA 13-12-2021-->
                <div class="row text-center mt-3" *ngIf="selectedProgramacion == 2" style="justify-content: center;">
                    <div class="col-lg-4 col-md-4 col-sm-4" style="cursor: pointer;" (click)="mostrarDetalleCliente()">
                        <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                            <div class="card-body text-center">
                                <i class="i-Ticket"></i>
                                <div class="content" style="max-width: 100% !important;">
                                    <p><span class="lead text-primary text-20 mb-2"
                                            style="font-weight: 600;">{{detalleClientes.length}}</span> <span
                                            class="text-primary mt-2 mb-0"> Clientes</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--FCA 07-12-2021 Se agrega grilla para detalle-->
                <div class="row"
                    *ngIf="detalleClientes.length >0 && selectedProgramacion == 2 && muestraDetalleClientes == true">
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="material-datatables">
                                    <table class="table table-striped table-no-bordered table-hover">
                                        <thead>
                                            <tr>
                                                <th scope="col">Rut</th>
                                                <th scope="col">Cliente</th>
                                                <th scope="col">Total Deuda</th>
                                                <th scope="col">Doc. Pendientes</th>
                                                <th scope="col">Detalle</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let c of detalleClientePag | paginate: config">
                                                <td>{{ c.rutCliente }}</td>
                                                <td>{{ c.nombreCliente }}</td>
                                                <td>{{ c.montoDeuda | monto }}</td>
                                                <td>{{ c.cantidadDocumentos}}</td>
                                                <td style="text-align: center;">
                                                    <img *ngIf="c.estadoDatos != -1"
                                                        (click)="verDetalle(c,modalDetalle)" container="body"
                                                        ngbTooltip="Ver Detalle" style="cursor: pointer;"
                                                        src="assets/images/show-property.png" width="27" height="27"
                                                        alt="">
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-md-12 mt-3" *ngIf="detalleClientePag?.length > 0">
                                    <pagination-controls (pageChange)="changePageClientes($event)" maxSize="6"
                                        responsive="true" previousLabel="" nextLabel="">
                                    </pagination-controls>
                                    <!-- <pagination-controls (pageChange)="page = $event" previousLabel="" nextLabel=""></pagination-controls> -->
                                </div>

                                <div class="row ml-4" *ngIf="selectedProgramacion == 2">
                                    <label class="text-danger">*Clientes mostrados corresponden a la fecha actual, puede
                                        variar al momento del envío.</label>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" *ngIf="detalleClientes?.length == 0 ">

                    <div class="col-md-12">
                        <ngb-alert class="alert-card text-center" [dismissible]="false">
                            No existen resultados para la consulta
                        </ngb-alert>
                    </div>
                </div>
            </wizard-step>

            <wizard-step #step4 [title]="'Finalizar'" [isValid]="IsStepFinalOk" (onComplete)="onComplete(wz)">
                <div class="text-center mt-4 mb-5">
                    <img src="https://img.icons8.com/cotton/2x/check-dollar.png" width="50" height="50" alt="">
                    <h5 class="font-weight-light mt-2">{{tituloFinal}}</h5>
                </div>


                <div class="row" style="justify-content: center;">
                    <div class="form-group col-md-4 mb-3">
                        <label for="nombre" class="text-lbl">Nombre Cobranza (*)</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="nombreC" name="nombreC" maxlength="60"
                                [(ngModel)]="nombreCobranza" placeholder="Ingrese nombre cobranza">
                        </div>
                    </div>
                </div>

                <div class="row" style="justify-content: center;">
                    <div class="form-group col-md-4 mb-3">
                        <div class="input-group">
                            <label class="switch switch-primary mr-3 mt-4">
                                <span>Enviar a todos los cargos.</span>
                                <input type="checkbox" name="chkContactos" [(ngModel)]="enviaTodosCargos">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row" style="justify-content: center;" *ngIf="!enviaTodosCargos">
                    <div class="form-group col-md-4 mb-3">
                        <label for="picker1" class="text-lbl">Cargos (*)</label>
                        <ng-select class="customAC" style="border-radius: 40px !important;" [items]="cargos"
                            bindLabel="carNom" placeholder="Cargos" #lpo="ngModel" name="lpo"
                            [(ngModel)]="selectedCargosContactos" bindValue="carCod" [multiple]="true"
                            [closeOnSelect]="true">
                        </ng-select>
                    </div>
                </div>

                <div class="row" style="justify-content: center;" *ngIf="!enviaTodosCargos">
                    <div class="form-group col-md-4 mb-3">
                        <div class="input-group">
                            <label class="switch switch-primary mr-3 mt-4">
                                <span>Si ningún contacto tiene el cargo seleccionado, Enviar a todos los
                                    contactos.</span>
                                <input type="checkbox" name="chkContactos" [(ngModel)]="enviaTodosContactos">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row" style="justify-content: center; margin-top: 10px;">
                    <div class="form-group col-md-4 mb-3">
                        <div class="input-group">
                            <label class="switch switch-primary mr-3 mt-4">
                                <span>Si cliente no tiene contactos, Enviar al correo de la ficha cliente.</span>
                                <input type="checkbox" name="chkFicha" [(ngModel)]="enviaCorreoFicha">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row" style="justify-content: center;">
                    <div class="form-group col-md-4 mb-3">
                        <div class="input-group">
                            <label class="switch switch-primary mr-3 mt-4" *ngIf="selectedProgramacion == 2">
                                <span>{{textoEstado}}</span>
                                <input type="checkbox" name="chkEstadoNuevo" [(ngModel)]="chkEstadoNuevo"
                                    (change)="onChangeNuevoEstado()">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="row text-center mt-3" style="justify-content: center;">
                    <!--FCA 07-12-2021 Solo muestra cantidad de correos si es envio clasico-->
                    <div *ngIf="selectedProgramacion == 1" class="col-lg-4 col-md-4 col-sm-4">
                        <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                            <div class="card-body text-center">
                                <i class="i-Mail-Send"></i>
                                <div class="content" style="max-width: 90px !important;">
                                    <p class="text-primary mt-2 mb-0">Clientes Seleccionados</p>
                                    <p class="lead text-primary text-19 mb-2" style="font-weight: 600;">
                                        {{cantidadCorreos}}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                            <div class="card-body text-center">
                                <i class="i-Financial"></i>
                                <div class="content" style="max-width: 90px !important;">
                                    <p class="text-primary mt-2 mb-0">A Recaudar</p>
                                    <p class="lead text-primary text-19 mb-2" style="font-weight: 600;">${{ totalPagar |
                                        monto}}</p>
                                </div>
                            </div>
                        </div>
                    </div> -->
                </div>
            </wizard-step>
        </form-wizard>

    </div>
</div>

<div class="row" *ngIf="muestraDetalle">
    <div class="col-md-12  mb-3">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-sm-flex mb-5">
                        <span class="m-auto"></span>
                        <button class="btn btn-primary mr-3 mb-sm-0 mb-3" (click)="volver()">Volver</button>
                    </div>
                    <!---===== Print Area =======-->
                    <div id="print-area">
                        <div class="row">
                            <div class="col-md-6">
                                <span>
                                    <h4 class="font-weight-bold">Cobranza</h4> #{{cobranzaDatos.idCobranza}}
                                </span>
                            </div>
                            <div class="col-md-6 text-sm-right">
                                <p><strong>Estado: </strong> {{cobranzaDatos.nombreEstado}}</p>
                                <p><strong>Fecha creación: </strong> {{cobranzaDatos.fechaCreacion | date:
                                    'dd/MM/yyyy'}}</p>
                                <!-- <p><strong>Usuario: </strong> {{cobranzaDatos.nombreUsuario}}</p> -->
                                <p><strong>Tipo: </strong> {{cobranzaDatos.nombreTipoCobranza}}</p>
                            </div>
                        </div>
                        <div class="mt-3 mb-4 border-top"></div>
                        <div class="row" *ngIf="cobranzaDatos.enviaEnlacePago == 1">

                            <div class="col-md-4 mb-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="mb-0 text-muted ml-4">Avance Cobranza</h5>
                                        <p class="text-12 font-weight-light mb-1 ml-4" style="margin-top: 12px;">
                                            Relación recaudado/recaudar</p>
                                        <div class="text-center" style="height: 140px;"><span
                                                class="text-45 text-{{cobranzaDatos.colorPorcentajeRecaudacion}}">{{cobranzaDatos.porcentajeRecaudacion}}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4 mb-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="mb-0 text-muted ml-4">Recaudar/Recaudado</h5>
                                        <p class="text-19 font-weight-bold mb-1 ml-4">${{cobranzaDatos.totalRecaudar |
                                            monto}} / ${{cobranzaDatos.totalRecaudado | monto}}</p>
                                        <div echarts [options]="chartMonto" [autoResize]="true" style="height: 140px;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4 mb-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="mb-0 text-muted ml-4">Doc Enviados/Pagados</h5>
                                        <p class="text-19 font-weight-bold mb-1 ml-4">
                                            {{cobranzaDatos.cantidadDocumentosEnviadosCobrar}} /
                                            {{cobranzaDatos.cantidadDocumentosPagados}}</p>
                                        <div echarts [options]="chartDocumentos" [autoResize]="true"
                                            style="height: 140px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group col-md-4 mb-3" style="margin-top: 20px;">
                                <label for="picker1" class="text-lbl">Estado</label>
                                <ng-select class="customAC" style="border-radius: 40px !important;"
                                    [items]="estadosDetalle" appendTo="body" bindLabel="descripcion" required
                                    placeholder="Seleccione tipo cobranza" #estadoDetalle="ngModel" name="estadoDetalle"
                                    [(ngModel)]="selectedEstadoDetalle" bindValue="id">
                                </ng-select>
                            </div>
                            <!--FCA 13-12-2021-->
                            <div class="form-group col-md-3 mb-3" style="margin-top: 20px;">
                                <label for="rutCliente" class="text-lbl">Rut Cliente</label>
                                <input type="text" class="form-control" (blur)="validateRut()" id="rutCliente"
                                    name="rutCliente" [(ngModel)]="searchRutDetalle" placeholder="Ingrese Rut Cliente">
                            </div>
                            <div class="form-group col-md-3 mb-3" style="margin-top: 20px;">
                                <label for="folioDetalle"
                                    onkeypress='return event.charCode >= 48 && event.charCode <= 57'
                                    class="text-lbl">Folio</label>
                                <input type="text" class="form-control" id="folioDetalle" name="folioDetalle"
                                    [(ngModel)]="filtroFolioDetalle" placeholder="Ingrese Folio">
                            </div>

                            <div class="form-group col-md-3 mb-3">
                                <div class="pt-3 mt-2">
                                    <button type="button" (click)="filterDetalle()" class="btn btn-primary btn-sm m-1">
                                        <i class="i-Filter-2 mr-2"></i> Filtrar</button>
                                    <button type="button" (click)="cleanFiltersDetalle()"
                                        class="btn btn-secondary btn-sm m-1"> <i class="i-To-Left mr-2"></i>
                                        Limpiar</button>
                                </div>
                            </div>
                        </div>


                        <div class="row" *ngIf="cobranzaDetalle.length > 0">

                            <div class="col-md-12">
                                <!--DESKTOP-->
                                <div class="desktop">
                                    <table class="table table-hover mb-4">
                                        <thead class="bg-gray-300">
                                            <tr>
                                                <th scope="col">Folio</th>
                                                <th scope="col">Tipo</th>
                                                <th scope="col">Cliente</th>
                                                <th scope="col">Monto</th>
                                                <th scope="col">Estado</th>
                                                <th scope="col">Abonos</th>
                                                <!-- <th scope="col" *ngIf="cobranzaDatos.enviaEnlacePago == 1">Fecha Pago
                                                </th>
                                                <th scope="col" *ngIf="cobranzaDatos.enviaEnlacePago == 1">Comprobante
                                                </th> -->
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let item of cobranzaDetalle | paginate: configDetalle">
                                                <th scope="row">{{item.folio}}</th>
                                                <td>{{item.tipoDocumento}}</td>
                                                <td>{{item.rutCliente}}</td>
                                                <td>${{item.monto | monto}}</td>
                                                <td>{{item.nombreEstado}}</td>
                                                <!-- <td *ngIf="cobranzaDatos.enviaEnlacePago == 1">{{item.fechaPagoTexto}}
                                                </td>
                                                <td *ngIf="cobranzaDatos.enviaEnlacePago == 1">
                                                    {{item.comprobanteContable}}
                                                </td> -->
                                                <td><button class="btn btn-primary"
                                                        (click)="openModalAbonos(detalleSaldo,item)">Ver Abonos</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!--MOVIL-->
                                <div class="movil">
                                    <table class="table table-hover mb-4">
                                        <thead class="bg-gray-300">
                                            <tr>
                                                <th scope="col">Folio</th>
                                                <th scope="col">Detalle</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let item of cobranzaDetalle | paginate: configDetalle">
                                                <td scope="row">{{item.folio}}</td>
                                                <td>
                                                    <strong>Tipo: </strong>{{item.tipoDocumento}}<br />
                                                    <strong>Cliente: </strong>{{item.rutCliente}}<br />
                                                    <strong>Monto: </strong>${{item.monto | monto}}<br />
                                                    <strong>Estado: </strong>{{item.nombreEstado}}<br />
                                                    <strong *ngIf="cobranzaDatos.enviaEnlacePago == 1">Estado:
                                                    </strong>{{item.fechaPagoTexto}}<br
                                                        *ngIf="cobranzaDatos.enviaEnlacePago == 1">
                                                    <strong *ngIf="cobranzaDatos.enviaEnlacePago == 1">Estado:
                                                    </strong>{{item.comprobanteContable}}<br
                                                        *ngIf="cobranzaDatos.enviaEnlacePago == 1">
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                            <!-- PAGINATION CONTROL -->
                            <div class="col-md-12 mt-3" *ngIf="cobranzaDetalle?.length && totalItemsDetalle > 0">
                                <pagination-controls (pageChange)="changePageDetalle($event)" maxSize="6"
                                    responsive="true" previousLabel="" nextLabel="">
                                </pagination-controls>
                                <!-- <pagination-controls (pageChange)="page = $event" previousLabel="" nextLabel=""></pagination-controls> -->
                            </div>
                        </div>

                        <div class="row" *ngIf="cobranzaDetalle.length == 0">
                            <div class="col-md-12">
                                <ngb-alert class="alert-card text-center" [dismissible]="false">
                                    No existen resultados para los filtros ingresados.
                                </ngb-alert>
                            </div>
                        </div>
                    </div>
                    <!--==== / Print Area =====-->
                    <div class="d-sm-flex mb-5">
                        <span class="m-auto"></span>
                        <button class="btn btn-primary mr-3 mb-sm-0 mb-3" (click)="volver()">Volver</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<ng-template #modalAddCorreo let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Agregar correo cliente</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <form>
            <div class="row">

                <div class="input-group col-md-8 mt-3" style="margin: auto;">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1">Correo Envío Cliente</span>
                    </div>
                    <input type="email" class="form-control" style="text-align: right;" [(ngModel)]="nuevoCorreo"
                        name="correoApo" placeholder="Ingrese correo electrónico" aria-label="correoApo"
                        aria-describedby="basic-addon1">
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="agregarCorreo()">Agregar</button>
    </div>
</ng-template>

<ng-template #modalDetalle let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Detalle de envío</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div class="row">
            <div class="col-md-6 col-6">
                <div class="mb-4">
                    <p class="text-primary mb-1"><i class="i-ID-Card text-16 mr-1"></i> Rut Cliente</p>
                    <span>{{clienteRut | sintexto}}</span>
                </div>
            </div>
            <div class="col-md-6 col-6">
                <div class="mb-4">
                    <p class="text-primary mb-1"><i class="i-Tag-5 text-16 mr-1"></i> Nombre Cliente</p>
                    <span>{{clienteNombre | sintexto}}</span>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h4 class="font-weight-bold text-primary">Documentos</h4>
                <table class="table table-hover mb-4">
                    <thead class="bg-gray-300">
                        <tr>
                            <th scope="col">Tipo</th>
                            <th scope="col">Folio</th>
                            <th scope="col">Fecha Vto.</th>
                            <th scope="col">Saldo</th>
                            <th *ngIf="selectedProgramacion == 1" scope="col">Eliminar</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of detalleDocumentos; let i = index">
                            <th scope="row">{{item.desDoc}}</th>
                            <td>{{item.numdoc}}</td>
                            <td>{{item.movfv | date: 'dd/MM/yyyy'}}</td>
                            <td>${{item.saldoadic | monto}}</td>
                            <!--FCA 07-12-2021 Se agrega validacion para solo mostrar eliminar para el tipo cobranza 1-->
                            <td *ngIf="selectedProgramacion == 1"><img (click)="eliminarDoc(item, i)" container="body"
                                    ngbTooltip="Eliminar" style="cursor: pointer;" src="./assets/images/delete.png"
                                    width="20" height="20" alt="Eliminar"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="modal.dismiss('Cross click')">Cerrar</button>
    </div>
</ng-template>


<ng-template #detalleSaldo let-modal>
    <div class="modal-header">
        <h4 class="modal-title justify-content-center" id="modal-basic-title">Abonos</h4>
        <button type="button" class="close" aria-label="Close" (click)="closeModal()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div class="row desktop">
            <div class="table-responsive mt-5">
                <table class="table ">
                    <thead>
                        <tr>
                            <th scope="col">Tipo De Documento</th>
                            <th scope="col">Número Documento</th>
                            <th scope="col">Fecha</th>
                            <th scope="col">Monto Abono $</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let a of abonos; let i = index">
                            <td><span class="text-13">{{a.documento}}</span></td>
                            <td><span class="text-13">{{a.nro}}</span></td>
                            <td><span class="text-13">{{a.fechaEmision | date: 'dd/MM/yyyy'}}</span></td>
                            <td><span class="text-13">{{a.montoBase | monto}}</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row movil">
            <div class="table-responsive mt-5">
                <table class="table ">
                    <thead>
                        <tr>
                            <th scope="col">Detalle</th>
                            <th scope="col">Monto Abono $</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let a of abonos; let i = index">
                            <td style="text-align: left;">
                                <strong>Documento: </strong>{{ a.desDoc }}<br />
                                <strong>Número: </strong>{{ a.numdoc }}<br />
                                <strong>Fecha Pago: </strong>{{a.movfe | date: 'dd/MM/yyyy'}}<br />
                            </td>
                            <td style="vertical-align: middle;"><span class="text-13">{{a.movMonto | monto}}</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>



    </div>
    <div class="modal-footer">
        <button type="button" (click)="closeModal()" class="btn btn-primary">Cerrar</button>
    </div>
</ng-template>